import{c as u}from"./notificiation.DEfUooIU.js";import{k as d,B as L}from"./index.BXL97NTB.js";import{a as B}from"./index.CViUNx8d.js";import{A as q}from"./auth.module.BlJkjLy5.js";const b=`${L}/api/events`,I=`${L}/api/guest`;let $=[];const p=B($);let A=[];const g=B(A),D=async()=>{try{const s=await d.get(`${b}`,{credentials:"include"}).json();p.set(s)}catch(s){(s.response.status===401||s.response.status===403)&&location.replace("/login"),console.log(s)}},G=async s=>{try{const n=await d.get(`${b}/events/${s}`,{credentials:"include"}).json();p.set(n)}catch(n){(n.response.status===401||n.response.status===403)&&location.replace("/login"),console.log(n)}},N=async s=>{try{const n=await d.get(`${I}/events/${s}`,{credentials:"include"}).json();g.set(n)}catch(n){console.log(n),u({title:"Error al cargar invitados",description:"No se pudo obtener la lista de invitados para este evento.",type:"error"})}},j=async s=>await d.get(`${I}/events/${s}/count`,{credentials:"include"}).json(),k=async s=>await d.get(`${b}/events/${s}`,{credentials:"include"}).json(),T=async s=>{const n=`${b}/${s.id}`;try{const t=await d.patch(n,{json:s}).json();p.set(p.get().map(e=>e.id===t.id?t:e)),u({title:"Evento actualizado",description:`${t.name}`,type:"success"})}catch(t){console.log(t);const e=await t.response.json();u({title:"Ups! Hubo un error",description:e.error,type:"error"})}},U=async s=>{const n=`${b}/${s}`;try{const t=await d.delete(n,{credentials:"include"});p.set(p.get().concat(t)),u({title:"Evento Eliminado",type:"success"})}catch(t){console.log(t);const e=await t.response.json();u({title:"Hubo un error al intentar eliminar el evento",description:e.error,type:"error"})}},x=async s=>{const n=`${I}/${s}`;try{const t=await d.delete(n,{credentials:"include"});g.set(g.get().concat(t)),u({title:"Invitado Eliminado",type:"success"})}catch(t){console.log(t);const e=await t.response.json();u({title:"Hubo un error al intentar eliminar al invitado",description:e.error,type:"error"})}},C=async s=>{const n=`${I}/${s.id}`;try{const t=await d.patch(n,{json:s,credentials:"include"}).json();g.set(g.get().map(e=>e.id===t.id?t:e)),u({title:"Invitado esdita correctamente",type:"success"})}catch(t){console.log(t);const e=await t.response.json();u({title:"Hubo un error al intentar editar al invitado",description:e.error,type:"error"})}},c={getEventsListForHome:D,getGuestsByEventId:j,updateEvents:T,getGuestsByUserId:k,getEventsListByUserId:G,getGuestsListByEventId:N,deleteGuestById:x,updateGuest:C,deleteEventById:U},H=document.querySelector("#events-item-template"),M=document.querySelector("#guests-item-template"),m=document.querySelector("#dashboard-list"),f=document.querySelector("#main-title"),P=await q.getLoggedUser(),h=P.id;await c.getEventsListByUserId(h);p.subscribe(async s=>{if(f.textContent==="Mis Eventos"){m.innerHTML="";for(const n of s){const t=H.content.cloneNode(!0).children[0],e=t.querySelector("#eventName"),E=t.querySelector("#event_date"),S=t.querySelector("#event_time"),_=t.querySelector("#guests_byEvents"),o=t.querySelector("#event_description");t.querySelector("li"),t.id=n.id;const a=await c.getGuestsByEventId(t.id);e.value=n.name,E.value=n.fecha_evento.split("T")[0],S.value=n.hora_evento,_.value=a.count,o.value=n.description,m.append(t)}}});m.addEventListener("click",async s=>{const n=s.target.closest(".edit-btn"),t=s.target.closest(".guests-btn"),e=s.target.closest("li"),E=s.target.closest(".delete-btn");if(n){const o=e.querySelector("#eventName"),a=e.querySelector("#event_date"),i=e.querySelector("#event_time"),r=e.querySelector("#event_description"),v=e.dataset.status;if(v==="inputs-deshabilitados"&&(o.removeAttribute("readonly"),a.removeAttribute("readonly"),i.removeAttribute("readonly"),r.removeAttribute("readonly"),e.dataset.status="inputs-habilitados",o.classList.add("outline","outline-solid","outline-black"),a.classList.add("outline","outline-solid","outline-cyan-500"),i.classList.add("outline","outline-solid","outline-cyan-500"),r.classList.add("outline","outline-solid","outline-cyan-500")),v==="inputs-habilitados"){o.setAttribute("readonly",!0),a.setAttribute("readonly",!0),i.setAttribute("readonly",!0),r.setAttribute("readonly",!0),e.dataset.status="inputs-deshabilitados",o.classList.remove("outline","outline-solid","outline-black"),a.classList.remove("outline","outline-solid","outline-cyan-500"),i.classList.remove("outline","outline-solid","outline-cyan-500"),r.classList.remove("outline","outline-solid","outline-cyan-500");const l={id:e.id,name:o.value,description:r.value,fecha_evento:a.value,hora_evento:i.value.split(":")[0]+":"+i.value.split(":")[1]};await c.updateEvents(l)}}if(E){const o=e.id;await c.deleteEventById(o),e.remove()}if(t){const o=t.closest("li"),a=o.id,i=o.querySelector("#eventName").value;await c.getGuestsListByEventId(a);const r=g.get();m.innerHTML="",f.textContent=`Invitados de: ${i}`;const v=document.createElement("button");v.textContent="Volver a Eventos",v.className="bg-pink-500 text-white py-2 px-4 rounded-md hover:bg-pink-600 transition-all duration-200 ease-in mb-4 self-start",v.onclick=async()=>{f.textContent="Mis Eventos",await c.getEventsListByUserId(h)},m.append(v);for(const l of r){const y=M.content.cloneNode(!0).children[0];y.id=l.id,y.querySelector("#guest_name").value=l.guest_name,y.querySelector("#guest_email").value=l.guest_email,y.querySelector("#fecha_envio").value=l.fecha_envio.split("T")[0],y.querySelector("#indications").value=l.indications;const w=y.querySelector("#estado_asistencia");w.value=l.estado_asistencia?"Confirmado":"Pendiente",w.className=`w-full rounded-md p-2 outline-none text-center font-bold ${l.estado_asistencia?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800"}`,m.append(y)}}if(s.target.closest(".edit-btn-guest")&&e.querySelector("#guest_name")){const o=e.dataset.status,a=e.querySelector("#guest_name"),i=e.querySelector("#indications");if(o==="inputs-deshabilitados")a.removeAttribute("readonly"),i.removeAttribute("readonly"),e.dataset.status="inputs-habilitados",a.classList.add("outline","outline-solid","outline-black"),i.classList.add("outline","outline-solid","outline-cyan-500");else if(o==="inputs-habilitados"){a.setAttribute("readonly",!0),i.setAttribute("readonly",!0),e.dataset.status="inputs-deshabilitados",a.classList.remove("outline","outline-solid","outline-black"),i.classList.remove("outline","outline-solid","outline-cyan-500");const r={id:e.id,guest_name:a.value,indications:i.value};await c.updateGuest(r)}}if(s.target.closest(".delete-btn-guest")&&e.querySelector("#guest_name")){const o=e.id;await c.deleteGuestById(o),e.remove()}});await c.getGuestsByUserId(h);
